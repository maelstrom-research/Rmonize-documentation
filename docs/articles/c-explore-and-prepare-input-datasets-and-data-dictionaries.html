<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Explore and prepare input datasets and data dictionaries</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Explore and prepare input datasets and data dictionaries">
<meta property="og:description" content="Rmonize">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Rmonize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li>
  <a href="../process/index.html">Process</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../glossary/index.html">Glossary</a>
</li>
<li>
  <a href="../news/index.html">Updates</a>
</li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/maelstrom-research/Rmonize/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Explore and prepare input datasets and data
dictionaries</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/maelstrom-research/Rmonize/blob/HEAD/vignettes/c-explore-and-prepare-input-datasets-and-data-dictionaries.Rmd" class="external-link"><code>vignettes/c-explore-and-prepare-input-datasets-and-data-dictionaries.Rmd</code></a></small>
      <div class="hidden name"><code>c-explore-and-prepare-input-datasets-and-data-dictionaries.Rmd</code></div>

    </div>

    
    
<p>In the vignette Simple example of data processing with Rmonize, we
used input datasets that are already cleaned and ready for processing.
However, exploration of input datasets is a critical step in data
harmonization. Generally, you will first need to examine the datasets
received from different studies to understand their contents and make
appropriate processing decisions. If data dictionaries or other metadata
are provided, this information can be incorporated into dataset
assessments and summaries. This vignette demonstrates some additional
capabilities of Rmonize (using functions from the underlying package
madshapR) to explore and prepare the input datasets and any associated
data dictionaries for use in processing.</p>
<div class="section level2">
<h2 id="load-packages">Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load relevant packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/maelstrom-research/Rmonize/" class="external-link">Rmonize</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/maelstrom-research/madshapR" class="external-link">madshapR</a></span><span class="op">)</span> <span class="co"># Additional functions to work with data dictionaries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GuiFabre/fabR" class="external-link">fabR</a></span><span class="op">)</span> <span class="co"># Additional functions to help with importing data</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span> <span class="co"># Collection of R packages for data science</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-original-datasets-and-data-dictionaries">Get original datasets and data dictionaries<a class="anchor" aria-label="anchor" href="#get-original-datasets-and-data-dictionaries"></a>
</h2>
<p>We refer to the version of datasets received from participating
studies with no modifications as ‘original’ datasets to distinguish them
from the input datasets ready for processing, which might have been
cleaned and/or formatted. Original datasets may come from various file
formats and require different levels of assessment and cleaning.
Depending on the file format, original datasets may also contain
variable metadata that can be extracted. The examples provided with
Rmonize include original datasets representing different file formats
and requiring different degrees of preparation. There are few structural
requirements for input datasets, except that they must be data frames or
tibbles in R.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get original datasets that were read from different file formats</span></span>
<span></span>
<span><span class="co"># Datasets from .sav files that contain variable metadata</span></span>
<span><span class="va">original_dataset_study1</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">original_dataset_study1</span></span>
<span><span class="va">original_dataset_study2</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">original_dataset_study2</span></span>
<span></span>
<span><span class="co"># Dataset from .csv file, with no data dictionary</span></span>
<span><span class="va">original_dataset_study3</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">original_dataset_study3</span></span>
<span></span>
<span><span class="co"># Datasets from .xlsx files, with data dictionaries in separate files</span></span>
<span><span class="va">original_dataset_study4</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">original_dataset_study4</span></span>
<span><span class="va">original_dataset_study5</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">original_dataset_study5</span></span></code></pre></div>
<p>Input data dictionaries (containing metadata about the variables in a
dataset) are not required for processing with Rmonize, but the
information they provide can be incorporated into input dataset
assessments and summaries. Data dictionaries can be read from separate
files or extracted directly from datasets, if available.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Existing metadata (e.g., from datasets from .sav files) can be extracted as data dictionaries</span></span>
<span><span class="va">original_dd_study1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_dict_extract.html">data_dict_extract</a></span><span class="op">(</span><span class="va">original_dataset_study1</span><span class="op">)</span></span>
<span><span class="va">original_dd_study2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_dict_extract.html">data_dict_extract</a></span><span class="op">(</span><span class="va">original_dataset_study2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># If data dictionaries are provided as separate files, assign them separately</span></span>
<span><span class="va">original_dd_study4</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">original_data_dictionary_study4</span></span>
<span><span class="va">original_dd_study5</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">original_data_dictionary_study5</span></span>
<span></span>
<span><span class="co"># A minimal data dictionary can be extracted from any dataset, but it provides very limited information</span></span>
<span><span class="va">extracted_dd_study3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_dict_extract.html">data_dict_extract</a></span><span class="op">(</span><span class="va">original_dataset_study3</span><span class="op">)</span></span></code></pre></div>
<p>For use in Rmonize, data dictionaries are formatted as a list with up
to two named data frames with information about Variables (mandatory)
and Categories (if any). You can see this format in data dictionaries
extracted with <code><a href="../reference/data_dict_extract.html">data_dict_extract()</a></code> and in online templates.
Original data dictionaries in other formats might need to be modified to
be compatible with Rmonize functions (see next section).</p>
</div>
<div class="section level2">
<h2 id="get-basic-evaluations-of-datasets-and-data-dictionaries">Get basic evaluations of datasets and data dictionaries<a class="anchor" aria-label="anchor" href="#get-basic-evaluations-of-datasets-and-data-dictionaries"></a>
</h2>
<p>A good first step is to check the basic structure of the original
inputs. Rmonize and madshapR include functions to evaluate object
structures and if they meet basic requirements for use in package
functions. In many cases, datasets and data dictionaries will already
have adequate structure, but if there are technical issues that would
prevent inputs from being used properly, evaluation functions can help
identify any modifications needed. In this section, we’ll focus on the
example inputs from study 4 to illustrate multiple possible evaluations
and preparations. (Note that you would not normally need to perform so
many different evaluations if the data dictionaries are
pre-formatted.)</p>
<p>First, we confirm that the dataset is a data frame (it is) and run a
dataset evaluation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Confirm that the dataset is a tibble</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/madshapR/man/is_dataset.html" class="external-link">is_dataset</a></span><span class="op">(</span><span class="va">original_dataset_study4</span><span class="op">)</span> <span class="co"># TRUE</span></span>
<span></span>
<span><span class="co"># Evaluate dataset only</span></span>
<span><span class="fu"><a href="../reference/dataset_evaluate.html">dataset_evaluate</a></span><span class="op">(</span><span class="va">original_dataset_study4</span><span class="op">)</span></span></code></pre></div>
<p>The evaluation generates an overview of the variables in the dataset
and informational messages if errors or potential issues are detected.
Looking at the <code>Dataset assessment</code> produced from the
example, there are suggestions for refined variable valueTypes (i.e.,
suitable encoding for variable data types) based on values in the
dataset, but no errors. Possible issues that might be detected at this
point include all-empty columns, duplicated columns, or non-standard
variable names.</p>
<p>Next, we examine the data dictionary. For package functions, a data
dictionary must be an R list with a data frame element named “Variables”
and have a few standardized column names (name, label, and valueType;
see online documentation). An evaluation cannot be performed until the
data dictionary meets these requirements, and any function using a data
dictionary will check for and print relevant error messages. We make
adjustments to the data dictionary for these requirements and evaluate
the modified data dictionary.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make the data dictionary a list containing a data frame named 'Variables'</span></span>
<span><span class="va">modified_dd_study4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Variables"</span> <span class="op">=</span> <span class="va">original_dd_study4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rename columns using standardized names</span></span>
<span><span class="va">modified_dd_study4</span><span class="op">$</span><span class="va">Variables</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">modified_dd_study4</span><span class="op">$</span><span class="va">Variables</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">Variable</span>,</span>
<span>         label <span class="op">=</span> <span class="va">Label</span>,</span>
<span>         valueType <span class="op">=</span> <span class="va">`Data type`</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate data dictionary only</span></span>
<span><span class="fu"><a href="../reference/data_dict_evaluate.html">data_dict_evaluate</a></span><span class="op">(</span><span class="va">modified_dd_study4</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>TIP:</strong> While we make all adjustments to the data
dictionary in this vignette with R scripts for illustrative purposes,
you could alternatively make some changes (e.g., renaming the sheet and
renaming columns) in the Excel document and reimport it into R.</p>
</blockquote>
<p>The evaluation generates an overview of the variables in the data
dictionary and informational messages if errors or potential issues are
detected. Notably, we see that there are error messages about valueTypes
not being of an accepted type, and that there is no information about
categories, even though there is a column called ‘Category codes’. This
is because there are specific accepted valueType values (see the package
object ‘valueType_list’ and <a href="https://opaldoc.obiba.org/en/latest/variables-data.html#variables-and-categories" class="external-link">online
documentation</a>), and the information about categories should be in a
separate data frame named ‘Categories’ (see online documentation). You
can correct these issues by recoding the values in the valueType column
and creating a separate ‘Categories’ data frame from the column with
information about categories.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the accepted 'valueType' values and their R equivalents</span></span>
<span><span class="fu">madshapR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/madshapR/man/valueType_list.html" class="external-link">valueType_list</a></span></span>
<span></span>
<span><span class="co"># Recode variable valueTypes</span></span>
<span><span class="va">compatible_dd_study4</span> <span class="op">&lt;-</span> <span class="va">modified_dd_study4</span></span>
<span></span>
<span><span class="va">compatible_dd_study4</span><span class="op">$</span><span class="va">Variables</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">compatible_dd_study4</span><span class="op">$</span><span class="va">Variables</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>valueType <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span></span>
<span>    <span class="va">valueType</span>,</span>
<span>    <span class="st">"character"</span> <span class="op">~</span> <span class="st">"text"</span>,</span>
<span>    <span class="st">"numeric"</span> <span class="op">~</span> <span class="st">"decimal"</span>,</span>
<span>    <span class="st">"integer"</span> <span class="op">~</span> <span class="st">"integer"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use function data_dict_expand() to create `Categories`</span></span>
<span><span class="op">?</span><span class="fu">madshapR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/madshapR/man/data_dict_expand.html" class="external-link">data_dict_expand</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># See the function documentation</span></span>
<span></span>
<span><span class="co"># Rename column `Category codes` with a standardized name for easy processing</span></span>
<span><span class="va">compatible_dd_study4</span><span class="op">$</span><span class="va">Variables</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">compatible_dd_study4</span><span class="op">$</span><span class="va">Variables</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>`Categories::label` <span class="op">=</span> <span class="va">`Category codes`</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create 'Categories' data frame</span></span>
<span><span class="va">compatible_dd_study4</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/madshapR/man/data_dict_expand.html" class="external-link">data_dict_expand</a></span><span class="op">(</span></span>
<span>  data_dict <span class="op">=</span> <span class="va">compatible_dd_study4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/madshapR/man/as_data_dict_mlstr.html" class="external-link">as_data_dict_mlstr</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Ensure correct formatting</span></span>
<span></span>
<span><span class="co"># Correctly code categories that indicate types of missing values</span></span>
<span><span class="va">compatible_dd_study4</span><span class="op">$</span><span class="va">Categories</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">compatible_dd_study4</span><span class="op">$</span><span class="va">Categories</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    missing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>      <span class="va">label</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Don't know"</span>, <span class="st">"Prefer not to answer"</span><span class="op">)</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rerun the data dictionary evaluation to confirm the corrections were made</span></span>
<span><span class="fu"><a href="../reference/data_dict_evaluate.html">data_dict_evaluate</a></span><span class="op">(</span><span class="va">compatible_dd_study4</span><span class="op">)</span></span></code></pre></div>
<p>After evaluating and modifying the dataset and data dictionary
independently, you can assess their validity for use with each other. No
modifications to the dataset are needed, but we format it explicitly as
an Rmonize dataset and identify the column with unique identifiers so
that this information can be used correctly in the evaluations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Format the dataset</span></span>
<span><span class="va">compatible_dataset_study4</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/as_dataset.html">as_dataset</a></span><span class="op">(</span><span class="va">original_dataset_study4</span>, col_id <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate the dataset and data dictionary together, as separate objects</span></span>
<span><span class="co"># Tip: Assign the output to an object for easier viewing.</span></span>
<span><span class="va">dataset_evaluation_study4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dataset_evaluate.html">dataset_evaluate</a></span><span class="op">(</span></span>
<span>  dataset <span class="op">=</span> <span class="va">compatible_dataset_study4</span>,</span>
<span>  data_dict <span class="op">=</span> <span class="va">compatible_dd_study4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the new informational messages in the RStudio viewer</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">dataset_evaluation_study4</span><span class="op">[[</span><span class="st">"Dataset assessment"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note: the informational messages about duplicated rows are a side effect</span></span>
<span><span class="co"># of a synthesized dataset with few variables. Rows are more likely to have</span></span>
<span><span class="co"># the same values.</span></span></code></pre></div>
<blockquote>
<p><strong>TIP:</strong> You can view the evaluation outputs in the
console or assign them to an object for more viewing options. For
example, this is helpful if there are many messages, and you want to
search for errors specifically. You can view the object in the RStudio
viewer, as in the script here, or export the output as a spreadsheet and
view it externally.</p>
</blockquote>
<p>Now we get different informational messages in the ‘Dataset
assessment’. Importantly, we see a few issues. In this example there is
a variable with different names in the dataset (marital_v1) and data
dictionary (marital), and two variables (drink_four_preg_v1 and
drink_four_preg_v3) where the valueType in the data dictionary is not
compatible with the valueType in the dataset. Closer examination of the
variables drink_four_preg_v1 and drink_four_preg_v3 in the dataset will
show that missing values have been coded as strings “NA”, making the
variables have valueType ‘character’, as opposed to the data dictionary
valueType ‘integer’.</p>
<p>Based on these messages, you can fix the name of marital_v1 in the
data dictionary and adjust the valueTypes of drink_four_preg_v1 and
drink_four_preg_v3 in the dataset.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Correct a variable name in the data dictionary to match the dataset</span></span>
<span><span class="va">formatted_dd_study4</span> <span class="op">&lt;-</span> <span class="va">compatible_dd_study4</span></span>
<span><span class="va">formatted_dd_study4</span><span class="op">$</span><span class="va">Variables</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">formatted_dd_study4</span><span class="op">$</span><span class="va">Variables</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"marital"</span>, <span class="st">"marital_v1"</span>, <span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">formatted_dd_study4</span><span class="op">$</span><span class="va">Categories</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">formatted_dd_study4</span><span class="op">$</span><span class="va">Categories</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"marital"</span>, <span class="st">"marital_v1"</span>, <span class="va">variable</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Adjust two variable valueTypes in the dataset to match the data dictionary</span></span>
<span><span class="va">formatted_dataset_study4</span> <span class="op">&lt;-</span> <span class="va">compatible_dataset_study4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># First convert "NA" strings to NA empty strings</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">drink_four_preg_v1</span>, <span class="va">drink_four_preg_v3</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/na_if.html" class="external-link">na_if</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"NA"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># Convert the variables to integer</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">drink_four_preg_v1</span>, <span class="va">drink_four_preg_v3</span><span class="op">)</span>, <span class="va">as_any_integer</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>At this point, you can associate the dataset with its data dictionary
to create one object that can be used in summary and reporting
functions.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Associate a dataset with its data dictionary (only possible when there are no</span></span>
<span><span class="co"># errors in the previous evaluation)</span></span>
<span><span class="va">dataset_with_dd_study4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_dict_apply.html">data_dict_apply</a></span><span class="op">(</span></span>
<span>  dataset <span class="op">=</span> <span class="va">formatted_dataset_study4</span>,</span>
<span>  data_dict <span class="op">=</span> <span class="va">formatted_dd_study4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># If you want, evaluate the dataset and data dictionary together</span></span>
<span><span class="co"># (confirms that there are no errors, but otherwise provides same information)</span></span>
<span><span class="fu"><a href="../reference/dataset_evaluate.html">dataset_evaluate</a></span><span class="op">(</span><span class="va">dataset_with_dd_study4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generate-dataset-summaries">Generate dataset summaries<a class="anchor" aria-label="anchor" href="#generate-dataset-summaries"></a>
</h2>
<p>You can get more detailed summaries and descriptive statistics about
a dataset and each variable with <code><a href="../reference/dataset_summarize.html">dataset_summarize()</a></code>. The
statistics provided for each variable are automatically determined based
on the variable’s data dictionary valueType. In this example, the
summary shows that the variable ‘age_v1’ has a maximum value of 350,
which is an error in the original dataset. The output of dataset
summaries can easily be exported as Excel files.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarize a dataset with an associated data dictionary</span></span>
<span><span class="va">summary_dataset_with_dd_study4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dataset_summarize.html">dataset_summarize</a></span><span class="op">(</span></span>
<span>  dataset <span class="op">=</span> <span class="va">dataset_with_dd_study4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the summary outputs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">summary_dataset_with_dd_study4</span><span class="op">)</span></span>
<span><span class="va">summary_dataset_with_dd_study4</span><span class="op">$</span><span class="va">`Numerical variable summary`</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># WARNING: This script creates a folder 'tmp'.</span></span>
<span><span class="va">output_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'tmp/'</span>,<span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">output_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/fabR/man/write_excel_allsheets.html" class="external-link">write_excel_allsheets</a></span><span class="op">(</span></span>
<span>  <span class="va">summary_dataset_with_dd_study4</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_path</span>,<span class="st">"/summary_dataset_with_dd_study4.xlsx"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>TIP:</strong> While you can run
<code><a href="../reference/dataset_summarize.html">dataset_summarize()</a></code> on any dataset, summaries are more
useful after datasets and data dictionaries have been assessed and
adjusted, if needed (e.g., categories correctly defined in the data
dictionary and valid valueTypes defined in the dataset and data
dictionary).</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="generate-visual-reports">Generate visual reports<a class="anchor" aria-label="anchor" href="#generate-visual-reports"></a>
</h2>
<p>You can also get visual summaries about a dataset and variables. The
function <code><a href="../reference/dataset_visualize.html">dataset_visualize()</a></code> generates an interactive html
document with summary figures for each variable. The figures provided
for each variable are automatically determined based on the variable’s
data dictionary valueType. Visual reports provide less detailed
statistics than tables from <code><a href="../reference/dataset_summarize.html">dataset_summarize()</a></code>, but some
features of the data may be easier to see in visual summaries.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Produce a visual report of the dataset and variables</span></span>
<span><span class="co"># You must specify a folder to contain the visual report files, and the folder name must not already exist.</span></span>
<span><span class="co"># WARNING: This script creates a folder 'tmp'.</span></span>
<span><span class="va">bookdown_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'tmp/'</span>,<span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">bookdown_path</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">bookdown_path</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/dataset_visualize.html">dataset_visualize</a></span><span class="op">(</span></span>
<span>  dataset <span class="op">=</span> <span class="va">dataset_with_dd_study4</span>,</span>
<span>  bookdown_path <span class="op">=</span> <span class="va">bookdown_path</span>,</span>
<span>  dataset_summary <span class="op">=</span> <span class="va">summary_dataset_with_dd_study4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Open the visual report in a browser.</span></span>
<span><span class="fu"><a href="../reference/bookdown_open.html">bookdown_open</a></span><span class="op">(</span><span class="va">bookdown_path</span><span class="op">)</span></span>
<span><span class="co"># Or open 'bookdown_path/docs/index.html'.</span></span></code></pre></div>
<blockquote>
<p><strong>TIP:</strong> While you can run
<code><a href="../reference/dataset_visualize.html">dataset_visualize()</a></code> on any dataset, summaries are more
useful after datasets and data dictionaries have been assessed and
adjusted, if needed (e.g., categories correctly defined in the data
dictionary and valid valueTypes defined in the dataset and data
dictionary).</p>
</blockquote>
<blockquote>
<p><strong>TIP:</strong> For large datasets with many rows and
variables, it can take a long time to generate summaries and visual
reports. You can summarize and generate reports for subsets of variables
to shorten processing times. If a summary report for the dataset was
previously generated and exists in the environment, it can be provided
in the dataset_summary parameter of <code><a href="../reference/dataset_visualize.html">dataset_visualize()</a></code> to
shorten processing time.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="prepare-input-datasets-ready-for-processing">Prepare input datasets ready for processing<a class="anchor" aria-label="anchor" href="#prepare-input-datasets-ready-for-processing"></a>
</h2>
<p>Once you have validated and applied any final cleaning that you want,
we suggest saving a version of the prepared input datasets as R files
that are easily accessible to maintain valueType information. If a data
dictionary was associated with the dataset, this metadata can also be
saved in the R file.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare a version of the cleaned validated input dataset (with associated data dictionary)</span></span>
<span><span class="va">input_dd_study4</span> <span class="op">&lt;-</span> <span class="va">formatted_dd_study4</span></span>
<span><span class="va">input_dataset_study4</span> <span class="op">&lt;-</span> <span class="va">formatted_dataset_study4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Erroneous values noted in summary reports can be removed</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_v1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">age_v1</span><span class="op">&gt;</span><span class="fl">100</span>, <span class="cn">NA</span>, <span class="va">age_v1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># If desired, specify the column that provides unique IDs</span></span>
<span>  <span class="fu"><a href="../reference/as_dataset.html">as_dataset</a></span><span class="op">(</span>col_id <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Associate the data dictionary</span></span>
<span>  <span class="fu"><a href="../reference/data_dict_apply.html">data_dict_apply</a></span><span class="op">(</span>data_dict <span class="op">=</span> <span class="va">input_dd_study4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare a version of the cleaned validated input dataset as an R file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">input_dataset_study4</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_path</span>,<span class="st">"/input_dataset_study4.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>TIP:</strong> In practice, it can be useful to create the
Data Processing Elements (DPE) in conjunction with evaluation of the
input datasets. This way the input elements, algorithms, and any
comments and questions about processing for each row of the DPE can be
written while the relevant input variables are being evaluated.</p>
</blockquote>
<blockquote>
<p><strong>TIP:</strong> Errors or outliers detected in summaries can be
corrected in the input dataset before processing data, or corrections
can be made explicitly in the algorithms written in the Data Processing
Elements.</p>
</blockquote>
<p>While not shown, the same overall preparation of input datasets would
be applied to the original datasets from other studies. The amount of
preparation needed will vary across different datasets, and the process
is iterative and may also need to be adjusted with any updates to
datasets or harmonization decisions.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maelstrom Research.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
