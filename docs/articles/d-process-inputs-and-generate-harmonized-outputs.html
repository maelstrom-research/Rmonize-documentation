<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Process inputs and generate harmonized outputs • Rmonize</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Process inputs and generate harmonized outputs">
<meta property="og:description" content="Rmonize">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Rmonize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0.9599</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a-install-your-working-environment.html">Install your working environment</a>
    </li>
    <li>
      <a href="../articles/b-simple-example-of-data-processing-with-Rmonize.html">Simple example of data processing with Rmonize</a>
    </li>
    <li>
      <a href="../articles/c-explore-and-prepare-input-datasets-and-data-dictionaries.html">Explore and prepare input datasets and data dictionaries</a>
    </li>
    <li>
      <a href="../articles/d-process-inputs-and-generate-harmonized-outputs.html">Process inputs and generate harmonized outputs</a>
    </li>
    <li>
      <a href="../articles/e-summarize-and-secure-harmonized-outputs.html">Summarize and secure harmonized outputs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/maelstrom-research/Rmonize/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Process inputs and generate harmonized
outputs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/maelstrom-research/Rmonize/blob/HEAD/vignettes/d-process-inputs-and-generate-harmonized-outputs.Rmd" class="external-link"><code>vignettes/d-process-inputs-and-generate-harmonized-outputs.Rmd</code></a></small>
      <div class="hidden name"><code>d-process-inputs-and-generate-harmonized-outputs.Rmd</code></div>

    </div>

    
    
<p>In the vignette Simple example of data processing with Rmonize, we
ran through an example with no processing errors. In reality, you might
encounter processing errors and need to troubleshoot the process and/or
inputs. This vignette focuses on running the main processing function
which uses the prepared input elements to produce harmonized datasets
and identifying and correcting errors in the Data Processing Elements
(DPE).</p>
<div class="section level2">
<h2 id="load-packages">Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load relevant packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/maelstrom-research/Rmonize/" class="external-link">Rmonize</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span> <span class="co"># Collection of R packages for data science</span></span></code></pre></div>
<blockquote>
<p><strong>TIP:</strong> You must install and load any packages whose
functions are used in individual algorithms in the Data Processing
Elements (see below), otherwise an error will be generated when
processing data with <code><a href="../reference/harmo_process.html">harmo_process()</a></code>.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="read-input-elements">Read input elements<a class="anchor" aria-label="anchor" href="#read-input-elements"></a>
</h2>
<p>The input elements needed for processing are the input datasets,
DataSchema, and DPEs, which are available from the examples included in
the package. This example uses cleaned input datasets and a DataSchema
that has no errors. We will start with a version of the DPE that has the
correct structure and required columns (see <a href="https://maelstrom-research.github.io/Rmonize-documentation/articles/a-Glossary-and-templates.html" class="external-link">online
documentation</a>), but has some issues that will create errors in
processing.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the input datasets</span></span>
<span><span class="va">dataset_study1</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">input_dataset_study1</span></span>
<span><span class="va">dataset_study2</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">input_dataset_study2</span></span>
<span><span class="va">dataset_study3</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">input_dataset_study3</span></span>
<span><span class="va">dataset_study4</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">input_dataset_study4</span></span>
<span><span class="va">dataset_study5</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">input_dataset_study5</span></span>
<span></span>
<span><span class="co"># Get the DataSchema</span></span>
<span><span class="va">dataschema</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">DataSchema</span></span>
<span></span>
<span><span class="co"># Get the Data Processing Elements</span></span>
<span><span class="va">dpe_with_errors</span> <span class="op">&lt;-</span> <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">`Data_Processing_Element_with errors`</span></span>
<span><span class="co"># This version contains some examples of potential processing errors.</span></span></code></pre></div>
<p>In the examples, the DPE contains processing instructions for all
five datasets, but you can prepare separate DPE documents for each input
dataset as well.</p>
</div>
<div class="section level2">
<h2 id="process-data">Process data<a class="anchor" aria-label="anchor" href="#process-data"></a>
</h2>
<p>If more than one input dataset is being processed at the same time,
they are provided as a named list of data frames (which we refer to as a
‘dossier’) with names matching the input_dataset values specified in the
DPE. The dataschema_variable values in the DPE must also match the
DataSchema provided. The output of <code><a href="../reference/harmo_process.html">harmo_process()</a></code> is a
‘harmonized dossier’, a list of harmonized dataset(s) with the same
name(s) as the input dataset(s), with specific attributes/metadata.</p>
<p>If there are basic issues with any of the input elements (e.g.,
elements have incorrect structure or are missing required columns), the
process will stop and print a message about the issue. If there are
errors in running individual algorithms, as in this example, the overall
process will run, but a message will be printed about ‘error’ statuses
being present.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create an input dossier</span></span>
<span><span class="va">input_dossier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dossier_create.html">dossier_create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">dataset_study1</span>,</span>
<span>  <span class="va">dataset_study2</span>,</span>
<span>  <span class="va">dataset_study3</span>,</span>
<span>  <span class="va">dataset_study4</span>,</span>
<span>  <span class="va">dataset_study5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run processing function</span></span>
<span><span class="va">harmonized_dossier_with_errors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/harmo_process.html">harmo_process</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">input_dossier</span>,</span>
<span>  dataschema <span class="op">=</span> <span class="va">dataschema</span>,</span>
<span>  data_proc_elem <span class="op">=</span> <span class="va">dpe_with_errors</span>,</span>
<span>  harmonized_col_dataset <span class="op">=</span> <span class="st">'adm_study_id'</span><span class="op">)</span> <span class="co"># Identifies the harmonized variable to use as dataset identifiers</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/vig4_fig01.png" alt="Subset of processing information printed in the console, including messages about errors in running individual algorithms." width="80%"><p class="caption">
Subset of processing information printed in the console, including
messages about errors in running individual algorithms.
</p>
</div>
<blockquote>
<p><strong>TIP:</strong> The function <code><a href="../reference/harmo_process.html">harmo_process()</a></code> can
be run on one study at a time (datasets and DPEs) or subsets of the
variables (DataSchema and DPEs) to help isolate issues.</p>
</blockquote>
<blockquote>
<p><strong>TIP:</strong> The dataset names in the list in the
input_dossier must match the input_dataset in the DPE.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="check-for-and-correct-errors-in-the-dpe">Check for and correct errors in the DPE<a class="anchor" aria-label="anchor" href="#check-for-and-correct-errors-in-the-dpe"></a>
</h2>
<p>Typically, any processing errors at this stage come from errors in
the DPEs (e.g., incorrectly written algorithms or misspecified input
variables). If there are any processing errors, the associated
harmonized dataset created is empty (no harmonized variable values) but
has attributes from the input elements, which can be used to identify
errors. Individual errors are printed in the console during processing
and can also be extracted with <code><a href="../reference/show_harmo_error.html">show_harmo_error()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># To identify processing errors to correct in the DPE</span></span>
<span><span class="fu"><a href="../reference/show_harmo_error.html">show_harmo_error</a></span><span class="op">(</span></span>
<span>  <span class="va">harmonized_dossier_with_errors</span>,</span>
<span>  show_warnings <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Can be informative, but can also be turned off, e.g., if there are known warnings produced by processing algorithms</span></span></code></pre></div>
<p>This prints the specific DataSchema variables and input datasets
affected by the errors and information about the specific error.</p>
<div class="figure" style="text-align: center">
<img src="images/vig4_fig02.png" alt="Subset of output from show_harmo_error() printed in the console." width="80%"><p class="caption">
Subset of output from show_harmo_error() printed in the console.
</p>
</div>
<p>In this example, there are errors in generating the DataSchema
variables preg_gestational_age_del and pm_birthweight in dataset_study4.
These variables have the specific errors ‘could not find function
“flor”’ and ‘object ’bbb_weight’ not found’, respectively. In this case,
inspecting the error messages and associated rows in the DPE indicate
that the errors come from typos. The function ‘flor’ used in the
algorithm for preg_gestational_age_del in dataset_study4 should instead
be ‘floor’, and the input_variable ‘bbb_weight’ used for pm_birthweight
in dataset_study4 should instead be ‘bb_weight’.</p>
<p>You can use these error messages to make necessary corrections in the
DPE Excel file and import the updated version of the DPE without errors
(this approach is usually simpler and clearer for documenting versions
of the DPE than making changes to the DPE in R).</p>
<div class="figure" style="text-align: center">
<img src="images/vig4_fig03.png" alt="Example of locating the errors in the DPE document." width="80%"><p class="caption">
Example of locating the errors in the DPE document.
</p>
</div>
<p>The processing is then rerun with the updated DPE and checked for
processing errors as many times as needed.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get corrected DPEs with changes made based on error messages</span></span>
<span><span class="va">dpe_no_errors</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">Rmonize_examples</span><span class="op">$</span><span class="va">`Data_Processing_Element_no errors`</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_data_proc_elem.html">as_data_proc_elem</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run processing function</span></span>
<span><span class="va">harmonized_dossier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/harmo_process.html">harmo_process</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">input_dossier</span>,</span>
<span>  dataschema <span class="op">=</span> <span class="va">dataschema</span>,</span>
<span>  data_proc_elem <span class="op">=</span> <span class="va">dpe_no_errors</span>,</span>
<span>  harmonized_col_dataset <span class="op">=</span> <span class="st">'adm_study_id'</span> <span class="co"># Identifies the harmonized variable to use as dataset identifiers</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Confirm there are no errors</span></span>
<span><span class="fu"><a href="../reference/show_harmo_error.html">show_harmo_error</a></span><span class="op">(</span></span>
<span>  <span class="va">harmonized_dossier</span>,</span>
<span>  show_warnings <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Typos are common sources of errors in the DPE, as are
mis-specifications in algorithms. Filling out the DPE can take some time
and attention to detail, but has benefits in comprehensively documenting
the processing done, providing a clear way to communicate with others
about the processing, and making it easier to identify issues and make
revisions to the processing. <a href="https://maelstrom-research.github.io/Rmonize-documentation/articles/b-Data-processing-elements.html" class="external-link">See
further documentation</a> for more details about the DPE.</p>
<p>Once there are no processing errors, the harmonized dossier can be
used to extract harmonization outputs (see the vignette Summarize and
secure harmonized outputs).</p>
</div>
<div class="section level2">
<h2 id="save-the-harmonized-dossier">Save the harmonized dossier<a class="anchor" aria-label="anchor" href="#save-the-harmonized-dossier"></a>
</h2>
<blockquote>
<p><strong>TIP:</strong> The harmonized dossier should be saved as an R
file so that the structure and all metadata is preserved and it can be
easily used in other Rmonize functions.</p>
</blockquote>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save the harmonized dossier as R file</span></span>
<span><span class="co"># WARNING: This script creates a folder 'tmp'.</span></span>
<span><span class="va">output_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'tmp/'</span>,<span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">output_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">harmonized_dossier</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_path</span>,<span class="st">"/harmonized_dossier.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Guillaume Fabre, Maelstrom-research group.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
